**堆外内存**

Netty在进行I/O操作时都是使用的堆外内存,可以避免数据从JVM堆内存到堆外内存的拷贝
如果在JVM内部执行I/O操作时,必须将数据拷贝到堆外内存,才能执行系统调用.这是所有VM语言都会存在的问题。不直接使用JVM堆内存进行I/O读写有两点原因：
1.操作系统并不感知JVM的堆内存，而且JVM的内存布局与操作系统所分配的是不一样的，操作系统并不会按照JVM的行为来读写数据。
2.同一个对象的内存地址随着JVM的GC的执行可能会随时发生变化，例如GC时进行压缩来减少内存碎片，这就涉及到了对象的移动。

**一种避免内存拷贝的设计思想**

如果有两个小数组，最后的结果要得到两个小数组合成的大数组，一般情况下要先建立一个大数组，然后将两个小数组的内容拷贝到大数组中去。

但是还可以通过设计一个新的对象，这个对象可以包含很多小数组，那么需要大对象的时候，只要将小数组引用到这个对象的属性里即可，而不需要拷贝。

比如Netty的CompositeByteBuf,它里面包含了很多Component,每个Component包裹着一个ByteBuf对象，当之前需要复制多个ByteBuf到一个新的ByteBuf的时候，现在只需建立多个Component对象，每个包裹一个ByteBuf，然后将Component放到CompositeByteBuf里去即可。



